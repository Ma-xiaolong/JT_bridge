# JT_bridge.vcxproj 配置对比表

## 快速对比：修改前 vs 修改后

| 配置项 | 修改前（初始） | 修改后（当前） | 影响 |
|--------|---------------|---------------|------|
| **Jammer文件路径** | `..\..\..\..\打包资料\接口对接材料1031\jammer\*.h` | `jammer\*.h` | ✅ 文件位于项目内，便于管理 |
| **VRLinkUtilStub.cpp** | ❌ 不存在 | ✅ 已添加 | ✅ 解决 DtWarn/DtInfo 链接错误 |
| **运行时库 (Debug)** | `MultiThreadedDLL` | `MultiThreadedDebugDLL` | ✅ 修复调试函数链接错误 |
| **库文件版本** | `vlutil.lib` | `vlutild.lib` | ✅ Debug 版本匹配 |
| **库文件版本** | `vlHLA13.lib` | `vlHLA13d.lib` | ✅ Debug 版本匹配 |
| **库文件版本** | `matrix.lib` | `matrixd.lib` | ✅ Debug 版本匹配 |
| **库链接顺序** | `vlutil.lib` 在中间 | `vlutild.lib` 在最前 | ✅ 确保符号解析正确 |
| **RTI库路径** | ❌ 未添加 | ✅ `D:\MAK\makRti4.4.2\lib` | ✅ 确保找到所有依赖库 |
| **预编译头** | `Use` | `NotUsing` (Debug|x64) | ✅ 避免兼容性问题 |

---

## 详细修改清单

### 1. 文件路径修改（第21-43行）

#### 修改前
```xml
<ClInclude Include="..\..\..\..\打包资料\接口对接材料1031\jammer\CtRefIJammer.h" />
<ClCompile Include="..\..\..\..\打包资料\接口对接材料1031\jammer\CtRefIJammer.cpp" />
```

#### 修改后
```xml
<ClInclude Include="jammer\CtRefIJammer.h" />
<ClCompile Include="jammer\CtRefIJammer.cpp" />
<ClCompile Include="jammer\VRLinkUtilStub.cpp" />  <!-- 新增 -->
```

**影响：**
- 所有 Jammer 文件从外部路径改为项目内路径
- 新增 VRLinkUtilStub.cpp 解决链接问题

---

### 2. 运行时库修改（第144行）

#### 修改前
```xml
<RuntimeLibrary>MultiThreadedDLL</RuntimeLibrary>
```

#### 修改后
```xml
<RuntimeLibrary>MultiThreadedDebugDLL</RuntimeLibrary>
```

**影响：**
- 修复 `__imp__CrtDbgReportW` 等调试函数的链接错误
- 与 VR-Link Debug 库的运行时库匹配

---

### 3. 库链接配置修改（第151-158行）

#### 修改前
```xml
<AdditionalLibraryDirectories>D:\MAK\vrlink4.0.9d\lib64;%(AdditionalLibraryDirectories)</AdditionalLibraryDirectories>
<AdditionalDependencies>vld.lib;
vl.lib;
vlHLA13.lib;
libRti-NG.lib
;vlutil.lib;
ws2_32.lib;
matrix.lib;%(AdditionalDependencies)</AdditionalDependencies>
```

#### 修改后
```xml
<AdditionalLibraryDirectories>D:\MAK\vrlink4.0.9d\lib64;D:\MAK\makRti4.4.2\lib;%(AdditionalLibraryDirectories)</AdditionalLibraryDirectories>
<AdditionalDependencies>vlutild.lib;
vl.lib;
vld.lib;
vlHLA13d.lib;
libRti-NG.lib;
ws2_32.lib;
matrixd.lib;%(AdditionalDependencies)</AdditionalDependencies>
```

**影响：**
- 使用 Debug 版本的库文件（带 'd' 后缀）
- 添加 RTI 库路径
- 调整库链接顺序（vlutild.lib 在前）

---

## 新建 DLL 项目配置模板

### 关键配置项

```xml
<!-- 1. 文件路径：使用项目内路径 -->
<ClInclude Include="yourmodule\*.h" />
<ClCompile Include="yourmodule\*.cpp" />
<ClCompile Include="yourmodule\VRLinkUtilStub.cpp" />  <!-- 如果需要 -->

<!-- 2. Debug|x64 编译配置 -->
<ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
  <ClCompile>
    <!-- 预处理器定义 -->
    <PreprocessorDefinitions>_DEBUG;YOURPROJECT_EXPORTS;_WINDOWS;_USRDLL;DtHLA;RTI_USES_STD_FSTREAM;MAK_DYNAMIC_LIBRARY;%(PreprocessorDefinitions)</PreprocessorDefinitions>
    
    <!-- 运行时库：Debug 版本 -->
    <RuntimeLibrary>MultiThreadedDebugDLL</RuntimeLibrary>
    
    <!-- 预编译头：建议不使用（避免兼容性问题） -->
    <PrecompiledHeader>NotUsing</PrecompiledHeader>
  </ClCompile>
  
  <Link>
    <!-- 库路径 -->
    <AdditionalLibraryDirectories>D:\MAK\vrlink4.0.9d\lib64;D:\MAK\makRti4.4.2\lib;%(AdditionalLibraryDirectories)</AdditionalLibraryDirectories>
    
    <!-- 库文件：Debug 版本（带 'd' 后缀） -->
    <AdditionalDependencies>vlutild.lib;vl.lib;vld.lib;vlHLA13d.lib;libRti-NG.lib;ws2_32.lib;matrixd.lib;%(AdditionalDependencies)</AdditionalDependencies>
  </Link>
</ItemDefinitionGroup>

<!-- 3. Release|x64 编译配置 -->
<ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
  <ClCompile>
    <PreprocessorDefinitions>NDEBUG;YOURPROJECT_EXPORTS;_WINDOWS;_USRDLL;DtHLA;RTI_USES_STD_FSTREAM;MAK_DYNAMIC_LIBRARY;%(PreprocessorDefinitions)</PreprocessorDefinitions>
    <RuntimeLibrary>MultiThreadedDLL</RuntimeLibrary>  <!-- Release 版本 -->
  </ClCompile>
  <Link>
    <AdditionalLibraryDirectories>D:\MAK\vrlink4.0.9d\lib64;D:\MAK\makRti4.4.2\lib;%(AdditionalLibraryDirectories)</AdditionalLibraryDirectories>
    <!-- 库文件：Release 版本（不带 'd' 后缀） -->
    <AdditionalDependencies>vlutil.lib;vl.lib;vlHLA13.lib;libRti-NG.lib;ws2_32.lib;matrix.lib;%(AdditionalDependencies)</AdditionalDependencies>
  </Link>
</ItemDefinitionGroup>

<!-- 4. 包含路径 -->
<PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
  <IncludePath>D:\MAK\makRti4.4.2\include\HLA13;D:\MAK\vrlink4.0.9d\include;$(IncludePath)</IncludePath>
  <LibraryPath>D:\MAK\vrlink4.0.9d\lib64;D:\MAK\makRti4.4.2\lib;$(LibraryPath)</LibraryPath>
</PropertyGroup>
```

---

## 配置影响总结

### ✅ 正面影响

1. **项目独立性**：文件位于项目内，不依赖外部路径
2. **编译成功**：解决了所有链接错误和编译错误
3. **版本匹配**：运行时库和库文件版本正确匹配
4. **兼容性**：适配 2013 年版本的 VR-Link 和 RTI

### ⚠️ 注意事项

1. **路径硬编码**：库路径是硬编码的，需要根据实际环境调整
2. **存根实现**：如果库中已有 `DtWarn`/`DtInfo`，可能需要移除存根
3. **Release 配置**：需要相应调整 Release 配置的库文件版本
4. **工具集版本**：使用 v100 (VS2010)，需要相应的开发环境

---

## 快速检查清单

创建新 DLL 项目时，按此清单检查：

```
□ 文件路径使用项目内相对路径
□ 包含 VRLinkUtilStub.cpp（如果链接错误）
□ Debug 配置使用 MultiThreadedDebugDLL
□ Debug 配置使用带 'd' 后缀的库
□ Release 配置使用 MultiThreadedDLL
□ Release 配置使用不带 'd' 后缀的库
□ 库链接顺序：vlutil 在前
□ 预处理器定义包含 DtHLA
□ 包含路径和库路径正确
□ 工具集版本匹配（v100 for VS2010）
```

